chrome.runtime.onMessage.addListener((t,o,n)=>{if(t.action=="analyzeImage"){const e=t.imageUrl;console.log("Analyzing Image URL:",t.imageUrl),i(e).then(r=>{n({success:!0,description:r})}).catch(r=>{n({success:!1,error:r.message})})}return!0});async function i(t){const{geminiApiKey:o}=await chrome.storage.sync.get("geminiApiKey");if(!o)throw new Error("API Key not Found. Please set in options page.");const n="http://127.0.0.1:5000/analyze-image";try{const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":o},body:JSON.stringify({imageUrl:t})});if(!e.ok)throw new Error("HTTP error!");const r=await e.json();if(!r.description)throw new Error("API did not return description.");return r}catch(e){throw console.error("API Calling Error: ",e),e}}
